<?php

namespace Database\Factories;

use App\Models\Organization;
use App\Models\SchoolBranding;
use App\Models\Staff;
use App\Models\StaffType;
use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;

class StaffFactory extends Factory
{
    protected $model = Staff::class;

    public function definition(): array
    {
        $organization = Organization::factory();

        return [
            'id' => (string) Str::uuid(),
            'organization_id' => $organization,
            'school_id' => SchoolBranding::factory()->for($organization),
            'staff_code' => null, // Auto-generated by model
            'full_name' => fake()->name(),
            'father_name' => fake()->name('male'),
            'email' => fake()->unique()->safeEmail(),
            'phone' => fake()->phoneNumber(),
            'gender' => fake()->randomElement(['male', 'female']),
            'birth_date' => fake()->date(),
            'age' => fake()->numberBetween(22, 65),
            'nationality' => 'Afghan',
            'tazkira_number' => fake()->numerify('##########'),
            'staff_type_id' => null,
            'hire_date' => now(),
            'employment_status' => 'active',
            'salary' => fake()->numberBetween(10000, 50000),
            'qualification' => fake()->randomElement(['bachelors', 'masters', 'phd']),
            'experience_years' => fake()->numberBetween(0, 20),
            'address' => fake()->address(),
            'emergency_contact_name' => fake()->name(),
            'emergency_contact_phone' => fake()->phoneNumber(),
            'picture_path' => null,
        ];
    }

    public function teacher(): static
    {
        return $this->state(function (array $attributes) {
            $staffType = StaffType::firstOrCreate([
                'name' => 'Teacher',
                'organization_id' => $attributes['organization_id'],
            ]);

            return [
                'staff_type_id' => $staffType->id,
            ];
        });
    }

    public function inactive(): static
    {
        return $this->state(fn (array $attributes) => [
            'employment_status' => 'inactive',
        ]);
    }
}
